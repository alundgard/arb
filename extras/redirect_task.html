<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="config.js"></script>
	<script src="verify.js"></script>
	<script src="mturk.js"></script>
	<script>
		$(document).ready(() => {
			console.log('ARB_IP', ARB_IP); // arb ip address from config.js
			console.log('VERIFY', VERIFY); // verify code from verify.js
			var arblink = ARB_IP + '?';
			var form_selector = "#mturk_form";

			// var va = VERIFY * KEY; console.log(va);
			// var vb = String(va / KEY); console.log(vb);

			// check verification code and submit
			function checkVerify() {
				let val = $('#verify').val();
				if (String(val) === VERIFY) {$('#mturk_form').submit();}
				else alert('ERROR: Incorrect Verification Code. Please enter a valid 4-digit code.');
			}

			var mturkp = window.location.href.split('?')[1] + '&'; // get mturk params
			var enc = '&enc=' + VERIFY * KEY; // encrypt verification code (*)
			var key = '&key=' + KEY; // send verification key
			var loc = arblink + mturkp + enc + key;
			$('#link').text(loc);
		});
	</script>
	<style>
		.container {
			height:auto;
			border: 1px solid red;
		}
		#link {
			width: 100px;
			height: auto;
			color: blue;
		}
	</style>
</head>

<body>
	<h1>Copy and paste the entire <span style="color:blue; border: 1px solid red;">blue URL</span> into a separate Google Chrome tab to begin the task immediately:</h1>
	<div class="container"><h1 id="link"></h1></div>
	<h2>Keep the current page open!
		When you have successfully completed the task, you will receive a 4-digit Task Completion Code to enter below.</h2>
	<form onsubmit="checkVerify()">
		<label for="verify">Enter the 4-digit Task Completion Code here finish submitting the HIT:</label>
		<input id="verify" type="text">
		<input type="submit" value="Submit" />
	</form>
	<form id="mturk_form"></form>
</body>
</html>